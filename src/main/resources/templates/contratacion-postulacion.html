<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4">
<head lang="en">
    <title>FixIT</title>
    <!--/*/ <th:block th:include="fragments/head :: head"></th:block> /*/-->
</head>
<body>
<div id="postulacion-mas">
    <!--/*/ <th:block th:include="fragments/header :: header"></th:block> /*/-->

    <!-- Modal logIn-->
    <!--/*/ <th:block th:include="modals/login :: login"></th:block> /*/-->

    <!-- Foto inicial -->
    <section id="section-foto">
        <div class="jumbotron-categoria2 text-center">
            <div class="container">
                <h1 class="titulo-prin-static">CONTRATACION</h1>
            </div>
        </div>
    </section>

    <section id="section-publicaciones">
        <div class="container">
            <h3 class="subtitulo-jobs" th:text="'Contratación de '+${postulacion.publicacion.titulo}"></h3>
            <div class="job-ad-item">
                <div class="item-info">
                    <div class="item-image-box col-md-2">
                        <div class="item-image prestador">
                            <img src='/images/perfil-prestador.png'
                                 onerror="this.src='/images/publicaciones/not-found.png'"
                                 alt="Image" class="img-responsive">
                        </div><!-- item-image -->
                    </div>

                    <div class="ad-info tab-postulaciones fixit-job-box col-md-3">
                        <div class="datos-prestador">
                            <div class="username-prestador">
                                <span th:text="'@'+${postulacion.usuarioPrestador.username}"></span>
                                <img th:if="${postulacion.usuarioPrestador.prestador.validado}" src='/images/validado.png' onerror="this.src='/images/publicaciones/not-found.png'" alt="Image" class="img-validado">
                            </div>
                            <div class="calificacion-user">
                                <i class="fa fa-star" aria-hidden="true"></i>
                                <span th:text="${postulacion.usuarioPrestador.calificacionPromedio}"></span>
                            </div>
                            <div class="historia-prestador">
                                <span th:text="'Trabajos Realizados: '+${postulacion.usuarioPrestador.prestador.cantContrataciones}"></span>
                                <span th:text="'Desde: '+${postulacion.usuarioPrestador.fechaCreacion}"></span>
                            </div>
                        </div>
                    </div>

                    <div class="ad-info tab-postulaciones fixit-job-box col-md-4">
                        <p class="installationType">
                            <span><strong th:text="${postulacion.descripcion}"></strong></span>
                        </p>
                        <span th:text="${postulacion.comentarios}"></span>
                        <div class="ad-meta">
                            <div class="iconos-postulacion"><i class="fa fa-credit-card" aria-hidden="true"></i> <small th:text="'Hasta '+${postulacion.presupAprox}+' '+${postulacion.currency}" class="btn-price-AR"></small></div>
                            <div class="iconos-postulacion"><i class="fa fa-calendar" aria-hidden="true"></i><small th:text="'Duración: '+${postulacion.duracionAprox}+ ' Horas'" class="btn-price-AR"></small></div>
                        </div><!-- ad-meta -->
                    </div><!-- ad-info -->

                </div>
            </div><!-- item-info -->


            <a th:onclick="${'contratar('+postulacion.id+')'}" class="btn btn-primary prestador tam-boton-100">Contratar Profesional</a>

        </div>

    </section>



    <!--/*/ <th:block th:include="fragments/footer :: footer"></th:block> /*/-->

</div>
</body>
<script>
    function contratar(postulacionId) {
        $.ajax({
            type: 'POST',
            url: '/contratar',
            data: {
                postulacionId: postulacionId
            },
            async: true,
            success: function(message){
                if(message.success){
                    swal({
                        title: "Postulación contratada!",
                        text: message.msg,
                        type: "success",
                    },function (e) {
                        window.location.href="/publicacion/list";
                    });
                }else{
                    swal("Error", message.msg, "error")
                }
            }
        });
    }
</script>
</html>